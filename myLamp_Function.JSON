[{"id":"d22fb41b.2066c8","type":"function","z":"904ea3e5.f009a","name":"myLamp","func":"var state = msg.payload;\nvar msg1 = {};\nvar msg2 = {};\nvar startTime = context.get('startTime')||0;\nvar now = Date.now();\nvar millis = now - startTime; // Elapsed time in ms\nvar blinkRate = context.get('blinkRate')||1000;\n\nswitch(state) {\n  case 0:\n        msg2.payload = 0;\n           break;\n  case 1:\n        msg2.payload = 1;\n    break;\n  case 2:\n      if(millis<=(blinkRate/2)){ \n        msg2.payload = 0;\n      }else{\n        msg2.payload = 1;\n        if(millis>blinkRate){\n            msg2.payload = 0;\n            context.set('startTime',now);\n        }\n      }\n    break  \n  default:\n    msg2.payload = 0;\n}\n\nif(msg2.payload===0){\n    node.status({fill:\"green\",shape:\"ring\",text:\"Lamp Off\"});\n}else{\n     node.status({fill:\"green\",shape:\"dot\",text:\"Lamp On\"});\n}\nif(msg.topic=='blinkRate'){\n    context.set('blinkRate',msg.payload);  // Blink rate\n    msg1.payload = msg.payload;\n}else{\n    msg1.payload = millis;\n}\nreturn [msg1,msg2];","outputs":2,"noerr":0,"x":594,"y":104,"wires":[["ab3cefa8.3d82"],["49915087.f7f2"]],"inputLabels":["xButton"],"outputLabels":["ElapsedTime","xLamp"]}]